<!DOCTYPE html>
<html>
	<head>
		<title>HTML5 Outliner tests</title>
		<script type="text/javascript" src="../dist/outliner.min.js"></script>
		<script type="text/javascript">
			var init=function()
			{
				var testList=[
					"spec1", "spec2", "navfirst", "hgroup"
				];
				
				var cleanWhiteSpace=function(s)
				{
					return s.replace(/\s/g, '');
				}
				
				var testOutline=function(testID, nextTest)
				{
					var docIframe = document.createElement("iframe"),
						outIframe = document.createElement("iframe"),
						doc=out=false;
					
					docIframe.src = testID + ".doc.html";
					docIframe.onload = function() { doc=docIframe.contentWindow.document.body; }
					
					outIframe.src = testID + ".out.html";
					outIframe.onload = function() { out=outIframe.contentWindow.document.body; }

					var runTest = function() {
						if (!doc || !out) return;
						clearInterval(waitForLoad);

						var expected = cleanWhiteSpace(out.innerHTML);
						var actual = cleanWhiteSpace(HTML5Outline(doc).asHTML());
						
						fireunit.compare(expected, actual, "Comparison for: "+testID);
						
						setTimeout(function(){
							docIframe.parentNode.removeChild(docIframe);
							outIframe.parentNode.removeChild(outIframe);
							nextTest();
						}, 100);
					}

					var waitForLoad=setInterval(runTest, 1);
					
					document.body.appendChild(docIframe);
					document.body.appendChild(outIframe);
				}
				
				document.getElementById('start').onclick=function()
				{
					if (typeof fireunit === 'object') {
					
						var i=0;
						var nextTest=function()
						{
							if (i < testList.length) {
								testOutline(testList[i], nextTest);
								i++;
							} else {
								fireunit.testDone();
							}
						}
						nextTest();
					}
					else alert("Fireunit required");
				}
			}
		</script>
	</head>
	<body onload="init();">
		<button id="start">Start</button>
		<hr />
	</body>
</html>